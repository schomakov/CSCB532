<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<div th:insert="~{header :: head}"></div>
<body class="d-flex flex-column min-vh-100">
<div th:replace="~{header :: header}"></div>
<main class="container mt-4">
    <h2>Пратки</h2>
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-3">
                <div class="card-header">Създай/Редактирай пратка</div>
                <div class="card-body">
                    <form th:action="@{/admin/parcels}" method="post" th:object="${parcel}">
                        <input type="hidden" th:field="*{id}" />
                        <div class="mb-2">
                            <label class="form-label">Подател (клиент)</label>
                            <select class="form-select" th:field="*{sender.id}" required>
                                <option th:each="c : ${clients}" th:value="${c.id}"
                                        th:text="${c.user != null ? (c.user.username + ' - ' + c.user.firstName + ' ' + c.user.lastName) : c.id}"></option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Получател - име</label>
                                <input class="form-control" th:field="*{recipientName}" required />
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Получател - телефон</label>
                                <input class="form-control" th:field="*{recipientPhone}" required />
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Получател (клиент, по избор)</label>
                            <select class="form-select" th:field="*{recipientClient.id}">
                                <option value="">--</option>
                                <option th:each="c : ${clients}" th:value="${c.id}"
                                        th:text="${c.user != null ? (c.user.username + ' - ' + c.user.firstName + ' ' + c.user.lastName) : c.id}"></option>
                            </select>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Тип доставка</label>
                            <select class="form-select" th:field="*{deliveryType}" required>
                                <option th:each="t : ${deliveryTypes}" th:value="${t}" th:text="${t}"></option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">От офис</label>
                                <select class="form-select" th:field="*{fromOffice.id}">
                                    <option value="">--</option>
                                    <option th:each="o : ${offices}" th:value="${o.id}" th:text="${o.name}"></option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-2" th:if="${parcel.deliveryType == T(com.nbu.CSCB532.model.logistics.DeliveryType).TO_OFFICE}">
                                <label class="form-label">До офис</label>
                                <select class="form-select" th:field="*{toOffice.id}">
                                    <option value="">--</option>
                                    <option th:each="o : ${offices}" th:value="${o.id}" th:text="${o.name}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <label class="form-label">Тегло (кг)</label>
                                <input type="number" step="0.01" min="0" class="form-control" th:field="*{weightKg}" required />
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label">Цена</label>
                                <input type="number" step="0.01" min="0" class="form-control" th:field="*{price}" placeholder="авто" />
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label">Статус</label>
                                <select class="form-select" th:field="*{status}" required>
                                    <option th:each="s : ${parcelStatuses}" th:value="${s}" th:text="${s}"></option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label">Куриер</label>
                                <select class="form-select" th:field="*{courier.id}">
                                    <option value="">--</option>
                                    <option th:each="e : ${employees}" th:value="${e.id}"
                                            th:text="${e.user != null ? (e.user.firstName + ' ' + e.user.lastName) : e.id}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="border rounded p-3 mb-3">
                            <h6>Адрес за доставка (ако е до адрес)</h6>
                            <div class="row">
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Държава" th:field="*{deliveryAddress.country}" /></div>
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Град" th:field="*{deliveryAddress.city}" /></div>
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Пощ. код" th:field="*{deliveryAddress.zipCode}" /></div>
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Улица" th:field="*{deliveryAddress.street}" /></div>
                            </div>
                            <input class="form-control" placeholder="Детайли" th:field="*{deliveryAddress.details}" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Тракинг код</label>
                            <input class="form-control" th:field="*{trackingCode}" placeholder="авто" />
                        </div>
                        <button type="submit" class="btn btn-primary">Запази</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Списък</div>
                <div class="card-body">
                    <div class="table-responsive" style="max-height: 60vh; overflow-y: auto;">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Код</th>
                                <th>Статус</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="p : ${parcels}">
                                <td th:text="${p.id}">1</td>
                                <td th:text="${p.trackingCode}">TRK-XXXX</td>
                                <td th:text="${p.status}">REGISTERED</td>
                                <td class="text-end">
                                    <a th:href="@{/admin/parcels/{id}/edit(id=${p.id})}" class="btn btn-sm btn-outline-secondary">Редактирай</a>
                                    <form th:action="@{/admin/parcels/{id}/delete(id=${p.id})}" method="post" style="display:inline" onsubmit="return confirm('Изтриване?');">
                                        <button class="btn btn-sm btn-outline-danger">Изтрий</button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<div th:replace="~{footer :: footer}"></div>
</body>
</html>
