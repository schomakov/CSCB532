<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<div th:insert="~{header :: head}"></div>
<body class="d-flex flex-column min-vh-100">
<div th:replace="~{header :: header}"></div>
<main class="container mt-4">
    <h2>Служител: Пратки</h2>
    <div class="row">
        <div class="col-md-7">
            <div class="card mb-3">
                <div class="card-header">Регистрирай изпратена пратка</div>
                <div class="card-body">
                    <form th:action="@{/employee/parcels}" method="post" th:object="${parcel}">
                        <div class="mb-2">
                            <label class="form-label">Подател (клиент)</label>
                            <select class="form-select" th:field="*{sender.id}" required>
                                <option th:each="c : ${clients}" th:value="${c.id}"
                                        th:text="${c.user != null ? (c.user.username + ' - ' + c.user.firstName + ' ' + c.user.lastName) : c.id}"></option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Получател - име</label>
                                <input class="form-control" th:field="*{recipientName}" required />
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Получател - телефон</label>
                                <input class="form-control" th:field="*{recipientPhone}" required />
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Получател (клиент, по избор)</label>
                            <select class="form-select" th:field="*{recipientClient.id}">
                                <option value="">--</option>
                                <option th:each="c : ${clients}" th:value="${c.id}"
                                        th:text="${c.user != null ? (c.user.username + ' - ' + c.user.firstName + ' ' + c.user.lastName) : c.id}"></option>
                            </select>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Тип доставка</label>
                            <select class="form-select" th:field="*{deliveryType}" required>
                                <option th:each="t : ${deliveryTypes}" th:value="${t}" th:text="${t}"></option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">От офис</label>
                                <select class="form-select" th:field="*{fromOffice.id}">
                                    <option value="">--</option>
                                    <option th:each="o : ${offices}" th:value="${o.id}"
                                            th:selected="${currentEmployee != null and currentEmployee.office != null and currentEmployee.office.id == o.id}"
                                            th:text="${o.name}"></option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-2" th:if="${parcel.deliveryType == T(com.nbu.CSCB532.model.logistics.DeliveryType).TO_OFFICE}">
                                <label class="form-label">До офис</label>
                                <select class="form-select" th:field="*{toOffice.id}">
                                    <option value="">--</option>
                                    <option th:each="o : ${offices}" th:value="${o.id}" th:text="${o.name}"></option>
                                </select>
                            </div>
                        </div>

                        <div class="border rounded p-3 mb-3">
                            <h6>Адрес за доставка (ако е до адрес)</h6>
                            <div class="row">
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Държава" th:field="*{deliveryAddress.country}" /></div>
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Град" th:field="*{deliveryAddress.city}" /></div>
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Пощ. код" th:field="*{deliveryAddress.zipCode}" /></div>
                                <div class="col-md-3 mb-2"><input class="form-control" placeholder="Улица" th:field="*{deliveryAddress.street}" /></div>
                            </div>
                            <input class="form-control" placeholder="Детайли" th:field="*{deliveryAddress.details}" />
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Тегло (кг)</label>
                                <input type="number" step="0.01" min="0" class="form-control" th:field="*{weightKg}" required />
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Цена</label>
                                <input type="number" step="0.01" min="0" class="form-control" th:field="*{price}" placeholder="авто" />
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Регистрирай</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="card">
                <div class="card-header">Пратки</div>
                <div class="card-body">
                    <div class="table-responsive" style="max-height: 60vh; overflow-y: auto;">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Код</th>
                                <th>Статус</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="p : ${parcels}">
                                <td th:text="${p.id}">1</td>
                                <td th:text="${p.trackingCode}">TRK-XXXX</td>
                                <td th:text="${p.status}">REGISTERED</td>
                                <td class="text-end">
                                    <form th:action="@{/employee/parcels/{id}/arrived-at-office(id=${p.id})}" method="post" style="display:inline"
                                      th:if="${p.status != T(com.nbu.CSCB532.model.logistics.ParcelStatus).AT_OFFICE and p.status != T(com.nbu.CSCB532.model.logistics.ParcelStatus).DELIVERED}">
                                        <button class="btn btn-sm btn-outline-secondary">Приета в офис</button>
                                    </form>
                                    <form th:action="@{/employee/parcels/{id}/receive(id=${p.id})}" method="post" style="display:inline"
                                          th:if="${p.status != T(com.nbu.CSCB532.model.logistics.ParcelStatus).DELIVERED}">
                                        <button class="btn btn-sm btn-outline-success">Получена</button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<div th:replace="~{footer :: footer}"></div>
</body>
</html>
